import{_ as S,a as u,g as c,h as D,c as l,i as $,b as s,t as a,d as f,n as v,F as x,j as B,u as V,o as r,m as F}from"./index-Mo_pLZJU.js";import{N as I}from"./NavBar-CTnWawuH.js";import{c as R,s as z}from"./index-C45fDmSP.js";const A={class:"profile-page"},L={class:"content"},M={class:"profile-card"},O={class:"avatar"},P={class:"user-info"},j={class:"headline-small"},E={class:"body-medium"},J={class:"stats-grid"},T={class:"stat-card"},q={class:"stat-num headline-large"},G={class:"stat-card"},H={class:"stat-num headline-large"},K={key:0,class:"stat-card warning"},Q={class:"stat-num headline-large"},U={class:"records-section md-card-outlined"},W={class:"tab-bar"},X={class:"record-list"},Y=["onClick"],Z={class:"record-cover"},ss=["src"],ts={key:1},es={class:"record-info"},os={class:"title-medium"},as={class:"body-small author"},ns={key:0,class:"dates"},ls={class:"body-small"},rs={key:1,class:"dates"},is={class:"body-small"},ds={key:0,class:"empty-records"},us={class:"body-medium"},cs={__name:"ProfileView",setup(vs){const y=V(),d=u(null),i=u([]),m=u([]),n=u("borrowed"),g=c(()=>i.value.filter(t=>t.status==="borrowed").length),k=c(()=>i.value.filter(t=>t.status==="returned").length),b=c(()=>i.value.filter(t=>t.status==="borrowed"&&h(t)).length),p=c(()=>n.value==="favorites"?m.value:i.value.filter(t=>t.status===n.value)),h=t=>t.status!=="borrowed"?!1:new Date(t.due_date)<new Date,_=t=>t?new Date(t).toLocaleDateString("zh-CN"):"-",w=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),y.push("/login")},C=async()=>{try{i.value=await R.getMyBorrows()}catch(t){console.error("åŠ è½½å€Ÿé˜…è®°å½•å¤±è´¥",t)}},N=async()=>{try{m.value=await z.getMyFavorites()}catch(t){console.error("åŠ è½½æ”¶è—å¤±è´¥",t)}};return D(()=>{const t=localStorage.getItem("user");t&&(d.value=JSON.parse(t)),C(),N()}),(t,e)=>(r(),l("div",A,[$(I),s("div",L,[s("div",M,[s("div",O,a(d.value?.name?.charAt(0)||"?"),1),s("div",P,[s("h2",j,a(d.value?.name),1),s("p",E,"å­¦å·ï¼š"+a(d.value?.student_id),1)]),s("button",{class:"md-outlined-button logout-btn",onClick:w}," é€€å‡ºç™»å½• ")]),s("div",J,[s("div",T,[e[3]||(e[3]=s("span",{class:"stat-icon"},"ğŸ“–",-1)),s("span",q,a(g.value),1),e[4]||(e[4]=s("span",{class:"stat-text body-medium"},"å½“å‰å€Ÿé˜…",-1))]),s("div",G,[e[5]||(e[5]=s("span",{class:"stat-icon"},"âœ…",-1)),s("span",H,a(k.value),1),e[6]||(e[6]=s("span",{class:"stat-text body-medium"},"å·²å½’è¿˜",-1))]),b.value>0?(r(),l("div",K,[e[7]||(e[7]=s("span",{class:"stat-icon"},"âš ï¸",-1)),s("span",Q,a(b.value),1),e[8]||(e[8]=s("span",{class:"stat-text body-medium"},"å·²é€¾æœŸ",-1))])):f("",!0)]),s("div",U,[e[10]||(e[10]=s("div",{class:"records-header"},[s("h3",{class:"title-large"},"ğŸ“š æˆ‘çš„å€Ÿé˜…è®°å½•")],-1)),s("div",W,[s("button",{class:v(["tab-btn",{active:n.value==="borrowed"}]),onClick:e[0]||(e[0]=o=>n.value="borrowed")}," å€Ÿé˜…ä¸­ ",2),s("button",{class:v(["tab-btn",{active:n.value==="returned"}]),onClick:e[1]||(e[1]=o=>n.value="returned")}," å·²å½’è¿˜ ",2),s("button",{class:v(["tab-btn",{active:n.value==="favorites"}]),onClick:e[2]||(e[2]=o=>n.value="favorites")}," æˆ‘çš„æ”¶è— ",2)]),s("div",X,[(r(!0),l(x,null,B(p.value,o=>(r(),l("div",{key:o.id,class:"record-item",onClick:_s=>o.book_id?t.$router.push(`/book/${o.book_id}`):null,style:F({cursor:o.book_id?"pointer":"default"})},[s("div",Z,[o.cover||o.book_cover?(r(),l("img",{key:0,src:o.cover||o.book_cover},null,8,ss)):(r(),l("span",ts,"ğŸ“–"))]),s("div",es,[s("h4",os,a(o.book_title),1),s("p",as,a(o.book_author),1),n.value!=="favorites"?(r(),l("div",ns,[s("span",ls,"å€Ÿé˜…ï¼š"+a(_(o.borrow_date)),1),s("span",{class:v(["body-small",{overdue:h(o)}])},a(o.status==="borrowed"?"åº”è¿˜":"å½’è¿˜")+"ï¼š "+a(_(o.status==="borrowed"?o.due_date:o.return_date)),3)])):(r(),l("div",rs,[s("span",is,"æ”¶è—äºï¼š"+a(_(o.created_at)),1)]))])],12,Y))),128)),p.value.length===0?(r(),l("div",ds,[e[9]||(e[9]=s("span",{class:"empty-icon"},"ğŸ“­",-1)),s("p",us,a(n.value==="borrowed"?"æš‚æ— å€Ÿé˜…ä¸­çš„å›¾ä¹¦":n.value==="returned"?"æš‚æ— å·²å½’è¿˜çš„å›¾ä¹¦":"æš‚æ— æ”¶è—çš„å›¾ä¹¦"),1)])):f("",!0)])])])]))}},hs=S(cs,[["__scopeId","data-v-a8eae425"]]);export{hs as default};
