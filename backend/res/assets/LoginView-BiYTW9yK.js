import{_,r as P,a as n,c as i,b as s,d as f,w as k,e as u,v as p,t as b,f as S,u as h,o as m}from"./index-Mo_pLZJU.js";import{a as x}from"./index-C45fDmSP.js";const U={class:"login-container"},q={class:"login-card md-card-elevated"},N={class:"md-outlined-text-field"},B={class:"md-outlined-text-field"},C={key:0,class:"error-container"},L={class:"body-medium"},T=["disabled"],D={key:0,class:"loading-spinner"},E={key:0,class:"md-dialog-scrim"},J={class:"md-dialog"},M={class:"md-outlined-text-field"},O={class:"md-outlined-text-field"},A={class:"md-outlined-text-field"},F={key:0,class:"error-container"},R={class:"body-medium"},j={__name:"LoginView",setup(z){const v=h(),d=P({studentId:"",password:""}),o=P({oldPassword:"",newPassword:"",confirmPassword:""}),r=n(!1),w=n(""),c=n(!1),a=n(""),g=n(""),y=n(null),I=async()=>{r.value=!0,w.value="";try{const t=await x.login(d.studentId,d.password);t.first_login?(g.value=t.token,y.value=t.user,o.oldPassword=d.password,c.value=!0):(localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),t.user.role==="admin"?v.push("/admin"):v.push("/"))}catch(t){w.value=t.detail||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­¦å·å’Œå¯†ç "}finally{r.value=!1}},V=async()=>{if(a.value="",o.newPassword!==o.confirmPassword){a.value="ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´";return}if(o.newPassword.length<6){a.value="æ–°å¯†ç è‡³å°‘6ä½";return}try{await x.changePassword(o.oldPassword,o.newPassword,g.value),localStorage.setItem("token",g.value),localStorage.setItem("user",JSON.stringify(y.value)),c.value=!1,y.value.role==="admin"?v.push("/admin"):v.push("/")}catch(t){a.value=t.detail||"å¯†ç ä¿®æ”¹å¤±è´¥"}};return(t,e)=>(m(),i("div",U,[s("div",q,[e[8]||(e[8]=s("div",{class:"login-header"},[s("div",{class:"logo-icon"},"ğŸ“š"),s("h1",{class:"headline-medium"},"å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ"),s("p",{class:"body-medium"},"ä½¿ç”¨å­¦å·ç™»å½•")],-1)),s("form",{onSubmit:k(I,["prevent"]),class:"login-form"},[s("div",N,[u(s("input",{type:"text",id:"studentId","onUpdate:modelValue":e[0]||(e[0]=l=>d.studentId=l),placeholder:" ",required:""},null,512),[[p,d.studentId]]),e[5]||(e[5]=s("label",{for:"studentId"},"å­¦å· / è´¦å·",-1))]),s("div",B,[u(s("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=l=>d.password=l),placeholder:" ",required:""},null,512),[[p,d.password]]),e[6]||(e[6]=s("label",{for:"password"},"å¯†ç ",-1))]),w.value?(m(),i("div",C,[e[7]||(e[7]=s("span",{class:"error-icon"},"âš ï¸",-1)),s("span",L,b(w.value),1)])):f("",!0),s("button",{type:"submit",class:"md-filled-button login-btn",disabled:r.value},[r.value?(m(),i("span",D)):f("",!0),S(" "+b(r.value?"ç™»å½•ä¸­...":"ç™» å½•"),1)],8,T)],32),e[9]||(e[9]=s("div",{class:"login-footer"},[s("p",{class:"body-small"},"é»˜è®¤å¯†ç ï¼š12345678"),s("p",{class:"body-small"},"é¦–æ¬¡ç™»å½•éœ€ä¿®æ”¹å¯†ç ")],-1))]),c.value?(m(),i("div",E,[s("div",J,[e[15]||(e[15]=s("h2",{class:"md-dialog-title"},"ä¿®æ”¹å¯†ç ",-1)),e[16]||(e[16]=s("p",{class:"md-dialog-content"},"é¦–æ¬¡ç™»å½•ï¼Œè¯·ä¿®æ”¹é»˜è®¤å¯†ç ä»¥ç¡®ä¿è´¦å·å®‰å…¨",-1)),s("form",{onSubmit:k(V,["prevent"]),class:"password-form"},[s("div",M,[u(s("input",{type:"password","onUpdate:modelValue":e[2]||(e[2]=l=>o.oldPassword=l),placeholder:" ",required:""},null,512),[[p,o.oldPassword]]),e[10]||(e[10]=s("label",null,"åŸå¯†ç ",-1))]),s("div",O,[u(s("input",{type:"password","onUpdate:modelValue":e[3]||(e[3]=l=>o.newPassword=l),placeholder:" ",required:"",minlength:"6"},null,512),[[p,o.newPassword]]),e[11]||(e[11]=s("label",null,"æ–°å¯†ç ",-1))]),s("div",A,[u(s("input",{type:"password","onUpdate:modelValue":e[4]||(e[4]=l=>o.confirmPassword=l),placeholder:" ",required:""},null,512),[[p,o.confirmPassword]]),e[12]||(e[12]=s("label",null,"ç¡®è®¤å¯†ç ",-1))]),a.value?(m(),i("div",F,[e[13]||(e[13]=s("span",{class:"error-icon"},"âš ï¸",-1)),s("span",R,b(a.value),1)])):f("",!0),e[14]||(e[14]=s("div",{class:"md-dialog-actions"},[s("button",{type:"submit",class:"md-filled-button"},"ç¡®è®¤ä¿®æ”¹")],-1))],32)])])):f("",!0)]))}},K=_(j,[["__scopeId","data-v-5ea8467c"]]);export{K as default};
