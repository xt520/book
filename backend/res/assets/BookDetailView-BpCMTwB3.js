import{_ as B,l as N,a as u,h as R,c as i,i as F,b as t,t as l,n as h,e as V,F as b,j as w,v as x,d as S,u as $,o as n}from"./index-Mo_pLZJU.js";import{N as A}from"./NavBar-CTnWawuH.js";import{b as I,s as _,c as z}from"./index-C45fDmSP.js";const E={class:"book-detail-page"},L={key:0,class:"content"},M={class:"book-detail-card"},j={class:"book-cover-large"},P=["src","alt"],T={key:1},U={class:"book-info-section"},q={class:"info-header"},G={class:"display-small"},H={class:"headline-small author"},J={class:"tags"},K={class:"category-chip"},O={class:"isbn-chip"},Q={class:"stock-info"},W={class:"stock-item"},X={class:"stock-item"},Y={class:"value"},Z={class:"actions"},tt=["disabled"],st={class:"reviews-section"},et={class:"title-large"},at={class:"write-review-card"},ot={class:"rating-input"},lt={class:"stars"},it=["onClick"],nt={class:"review-actions"},ct=["disabled"],rt={class:"review-list"},dt={class:"review-header"},vt={class:"reviewer-name title-medium"},ut={class:"review-date body-small"},_t={class:"review-rating"},ht={class:"review-content body-medium"},pt={key:0,class:"empty-reviews"},mt={key:1,class:"loading-state"},bt={key:2,class:"error-state"},wt={__name:"BookDetailView",setup(kt){const g=N();$();const c=g.params.id,e=u(null),d=u([]),v=u(!1),p=u(!0),r=u({rating:5,content:""}),k=async()=>{p.value=!0;try{const o=await I.getDetail(c);e.value=o;try{const[s,a]=await Promise.all([_.getReviews(c),_.isFavorite(c)]);d.value=s,v.value=a}catch(s){console.warn("Social features failed to load:",s)}}catch(o){console.error("åŠ è½½è¯¦æƒ…å¤±è´¥",o),e.value=null}finally{p.value=!1}},y=async()=>{try{await _.toggleFavorite(c),v.value=!v.value}catch{alert("æ“ä½œå¤±è´¥")}},f=async()=>{if(confirm(`ç¡®è®¤å€Ÿé˜…ã€Š${e.value.title}ã€‹ï¼Ÿ`))try{await z.borrow(c),alert("å€Ÿé˜…æˆåŠŸï¼"),k()}catch(o){alert(o.detail||"å€Ÿé˜…å¤±è´¥")}},D=async()=>{try{await _.createReview(c,r.value),alert("è¯„è®ºå‘å¸ƒæˆåŠŸ"),r.value.content="",d.value=await _.getReviews(c)}catch(o){alert(o.detail||"å‘å¸ƒå¤±è´¥")}},C=o=>new Date(o).toLocaleString("zh-CN");return R(()=>{k()}),(o,s)=>(n(),i("div",E,[F(A),e.value?(n(),i("div",L,[t("div",M,[t("div",j,[e.value.cover?(n(),i("img",{key:0,src:e.value.cover,alt:e.value.title},null,8,P)):(n(),i("span",T,"ðŸ“–"))]),t("div",U,[t("div",q,[t("h1",G,l(e.value.title),1),t("button",{class:h(["favorite-btn",{active:v.value}]),onClick:y,title:"æ”¶è—"},l(v.value?"â¤ï¸":"ðŸ¤"),3)]),t("p",H,l(e.value.author),1),t("div",J,[t("span",K,l(e.value.category),1),t("span",O,"ISBN: "+l(e.value.isbn||"æœªçŸ¥"),1)]),t("div",Q,[t("div",W,[s[2]||(s[2]=t("span",{class:"label"},"å¯å€Ÿ",-1)),t("span",{class:h(["value",{"out-of-stock":e.value.available_count===0}])},l(e.value.available_count),3)]),t("div",X,[s[3]||(s[3]=t("span",{class:"label"},"æ€»è—",-1)),t("span",Y,l(e.value.total_count),1)])]),t("div",Z,[t("button",{class:"md-filled-button borrow-btn",disabled:e.value.available_count===0,onClick:f},l(e.value.available_count>0?"ç«‹å³å€Ÿé˜…":"æš‚æ—¶ç¼ºè´§"),9,tt)])])]),t("div",st,[t("h2",et,"ðŸ“š è¯»è€…è¯„è®º ("+l(d.value.length)+")",1),t("div",at,[t("div",ot,[s[4]||(s[4]=t("span",{class:"label-medium"},"è¯„åˆ†ï¼š",-1)),t("div",lt,[(n(),i(b,null,w(5,a=>t("span",{key:a,class:h(["star",{active:r.value.rating>=a}]),onClick:m=>r.value.rating=a}," â˜… ",10,it)),64))])]),V(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>r.value.content=a),placeholder:"å†™ä¸‹ä½ çš„è¯»åŽæ„Ÿ...",rows:"3",class:"review-input"},null,512),[[x,r.value.content]]),t("div",nt,[t("button",{class:"md-tonal-button",onClick:D,disabled:!r.value.content}," å‘å¸ƒè¯„è®º ",8,ct)])]),t("div",rt,[(n(!0),i(b,null,w(d.value,a=>(n(),i("div",{key:a.id,class:"review-item"},[t("div",dt,[t("span",vt,l(a.user_name),1),t("span",ut,l(C(a.created_at)),1)]),t("div",_t,[(n(),i(b,null,w(5,m=>t("span",{key:m,class:h(["star-small",{active:a.rating>=m}])},"â˜…",2)),64))]),t("p",ht,l(a.content),1)]))),128)),d.value.length===0?(n(),i("div",pt,[...s[5]||(s[5]=[t("p",{class:"body-medium"},"æš‚æ— è¯„è®ºï¼Œæ¥æŠ¢æ²™å‘å§ï¼",-1)])])):S("",!0)])])])):p.value?(n(),i("div",mt,[...s[6]||(s[6]=[t("p",null,"åŠ è½½ä¸­...",-1)])])):(n(),i("div",bt,[s[7]||(s[7]=t("p",null,"æœªæ‰¾åˆ°è¯¥å›¾ä¹¦",-1)),t("button",{class:"md-text-button",onClick:s[1]||(s[1]=a=>o.$router.push("/"))},"è¿”å›žé¦–é¡µ")]))]))}},Dt=B(wt,[["__scopeId","data-v-d6f4cade"]]);export{Dt as default};
